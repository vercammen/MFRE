<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Time Series Analysis of Food and Energy Prices</title>
  <meta name="description" content="This chapter describes the data preparation procedures." />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Time Series Analysis of Food and Energy Prices" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This chapter describes the data preparation procedures." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Time Series Analysis of Food and Energy Prices" />
  
  <meta name="twitter:description" content="This chapter describes the data preparation procedures." />
  

<meta name="author" content="James Vercammen" />


<meta name="date" content="2023-02-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path=""><a href="#data-preparation"><i class="fa fa-check"></i><b>1</b> Data Preparation</a>
<ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#sec:intro"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#sec:packages"><i class="fa fa-check"></i><b>1.2</b> Data Import and Packages</a></li>
<li class="chapter" data-level="1.3" data-path=""><a href="#sec:applications"><i class="fa fa-check"></i><b>1.3</b> Applications</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path=""><a href="#accessing-data-with-an-api"><i class="fa fa-check"></i><b>1.3.1</b> Accessing Data with an API</a></li>
<li class="chapter" data-level="1.3.2" data-path=""><a href="#chapter-1-monthly-prices-of-crude-oil-and-wheat"><i class="fa fa-check"></i><b>1.3.2</b> Chapter 1: Monthly prices of Crude Oil and Wheat</a></li>
<li class="chapter" data-level="1.3.3" data-path=""><a href="#chapter-4-part-a-banana-prices"><i class="fa fa-check"></i><b>1.3.3</b> Chapter 4 (Part A): Banana Prices</a></li>
<li class="chapter" data-level="1.3.4" data-path=""><a href="#chapter-4-part-b-daily-crude-oil-futures-prices"><i class="fa fa-check"></i><b>1.3.4</b> Chapter 4 (Part B): Daily Crude Oil Futures Prices</a></li>
<li class="chapter" data-level="1.3.5" data-path=""><a href="#chapter-4-part-c-cpi-and-potato-prices"><i class="fa fa-check"></i><b>1.3.5</b> Chapter 4 (Part C): CPI and Potato Prices</a></li>
<li class="chapter" data-level="1.3.6" data-path=""><a href="#chapter-5-industrial-production-and-eggs"><i class="fa fa-check"></i><b>1.3.6</b> Chapter 5: Industrial Production and Eggs</a></li>
<li class="chapter" data-level="1.3.7" data-path=""><a href="#chapter-6-part-a-gasoline-price"><i class="fa fa-check"></i><b>1.3.7</b> Chapter 6 (Part A): Gasoline Price</a></li>
<li class="chapter" data-level="1.3.8" data-path=""><a href="#chapter-6-part-b-electricity---natural-gas-margin"><i class="fa fa-check"></i><b>1.3.8</b> Chapter 6 (Part B): Electricity - Natural Gas Margin</a></li>
<li class="chapter" data-level="1.3.9" data-path=""><a href="#chapter-6-part-c-simulated-structural-break-data"><i class="fa fa-check"></i><b>1.3.9</b> Chapter 6 (Part C): Simulated Structural Break Data</a></li>
<li class="chapter" data-level="1.3.10" data-path=""><a href="#chapter-7-fruit-corn-energy-hogs-and-exchange-rate"><i class="fa fa-check"></i><b>1.3.10</b> Chapter 7: Fruit, Corn, Energy, Hogs and Exchange Rate</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path=""><a href="#chapter-7-simulated-arima-data"><i class="fa fa-check"></i><b>1.4</b> Chapter 7: Simulated ARIMA Data</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path=""><a href="#chapter-8-woodchips-and-heating-oil"><i class="fa fa-check"></i><b>1.4.1</b> Chapter 8: Woodchips and Heating Oil</a></li>
<li class="chapter" data-level="1.4.2" data-path=""><a href="#chapter-9-vegetable-oils-and-biofuels"><i class="fa fa-check"></i><b>1.4.2</b> Chapter 9: Vegetable Oils and Biofuels</a></li>
<li class="chapter" data-level="1.4.3" data-path=""><a href="#chapter-10-part-a-canada---u.s.-crude-oil"><i class="fa fa-check"></i><b>1.4.3</b> Chapter 10 (Part A): Canada - U.S. Crude Oil</a></li>
<li class="chapter" data-level="1.4.4" data-path=""><a href="#chapter-10-part-b-diesel-fuel-rainfall-and-vegetable-cpi"><i class="fa fa-check"></i><b>1.4.4</b> Chapter 10 (Part B): Diesel Fuel, Rainfall and Vegetable CPI</a></li>
<li class="chapter" data-level="1.4.5" data-path=""><a href="#chapter-11-data-to-be-determined"><i class="fa fa-check"></i><b>1.4.5</b> Chapter 11: Data to be Determined</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path=""><a href="#sec:rds"><i class="fa fa-check"></i><b>1.5</b> Saved RDS files</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path=""><a href="#extra-lumber-data"><i class="fa fa-check"></i><b>1.5.1</b> Extra: Lumber Data</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path=""><a href="#conclusions"><i class="fa fa-check"></i><b>1.6</b> Conclusions</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time Series Analysis of Food and Energy Prices</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Time Series Analysis of Food and Energy Prices</h1>
<p class="author"><em>James Vercammen</em></p>
<p class="date"><em>2023-02-19</em></p>
</div>
<div id="data-preparation" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Chapter 1</span> Data Preparation<a href="#data-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter shows the R programming steps which are used to prepare the data for the various empirical applications in this textbook. The textbook has eight chapters with empirical applications and each chapter has one or more applications. For each application the raw data is read into R from an API such as the Federal Reserve Economic Data (FRED) or from an Excel or csv file. The prepared data for each application is saved into an <em>.RDS</em> file. The collection of <em>.RDS</em> files for a particular chapter are read into R when the code for that chapter is run. Another word for data preparation is data wrangling. Part of the data preparation process may involve data cleaning, which is typically used to deal with missing data and mistakes in the data.</p>
<p>Section <a href="#sec:intro">1.1</a> provides a brief introduction, which includes a link to a blog post about data preparation best practices and the links to the various websites which contain the raw data to be prepared. In Section <a href="#sec:packages">1.2</a> the general data import procedures are described and the various R packages which are used for the data preparation are loaded. The data preparation procedures for each of the empirical applications in Chapters 1 and 4 through 11 are described in Section <a href="#sec:applications">1.3</a>. Section <a href="#sec:rds">1.5</a> contains the optional code for saving the prepared data sets to individual <em>.RDS</em> files.</p>
<div id="sec:intro" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Introduction<a href="#sec:intro" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Time series raw data must typically be prepared before it can be analyzed. In some cases simple steps such as filtering for the correct range of dates and identifying the date column for creating the time series variable is all that is is needed. In other cases, considerable data wrangling is required. This includes omitting rows of a csv or Excel file when importing, converting column names into strings which are compatible with R (e.g., no spaces) and converting data which arrives in character format into date format.</p>
<p>Coding practices vary across individuals but it is nevertheless important to adhere to coding best practices when preparing data. A good summary of the general coding practices which are relevant for R can be found at <a href="https://style.tidyverse.org/syntax.html" class="uri">https://style.tidyverse.org/syntax.html</a>.</p>
<p>The specific data preparation procedures are shown for the applications in the following chapters. Unless otherwise noted, the variables refer to prices for U.S. commodities, measured in U.S. dollars.</p>
<ul>
<li>Chapter 1: Global wheat and crude oil.</li>
<li>Chapter 4: Bananas, consumer price index (CPI), Crude oil (daily) and potatoes.</li>
<li>Chapter 5: CPI, industrial production index, wheat and crude oil, Alberta eggs.</li>
<li>Chapter 6: Gasoline and electricity.</li>
<li>Chapter 7: Fruit, Vancouver gasoline, corn, energy consumption temperature anomalies and hog prices.</li>
<li>Chapter 8: Wood chips and heating oil prices.</li>
<li>Chapter 9: Vegetable oil prices and biofuel prices.</li>
<li>Chapter 10: Canada and U.S. crude oil prices, and Veggie CPI, drought and diesel fuel prices.</li>
<li>Chapter 11: To be determined.</li>
</ul>
<p>The on-line links to these data sets are as follows:</p>
<table>
<colgroup>
<col width="23%" />
<col width="35%" />
<col width="41%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Chpt</th>
<th align="left">Data</th>
<th align="left">URL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">Global wheat</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/PWHEAMTUSDM" class="uri">https://fred.stlouisfed.org/series/PWHEAMTUSDM</a></td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">WTI crude oil (monthly)</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/MCOILWTICO" class="uri">https://fred.stlouisfed.org/series/MCOILWTICO</a></td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">Bananas</td>
<td align="left"><a href="https://www.indexmundi.com/commodities/?commodity=bananas&amp;months=240" class="uri">https://www.indexmundi.com/commodities/?commodity=bananas&amp;months=240</a></td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">WTI crude oil (monthly)</td>
<td align="left">Same as Chapter 1.</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">WTI crude (daily-web API)</td>
<td align="left"><a href="https://eodhistoricaldata.com" class="uri">https://eodhistoricaldata.com</a></td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">Consumer price index</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/CPIAUCSL" class="uri">https://fred.stlouisfed.org/series/CPIAUCSL</a></td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">Farm price of potatoes</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/WPU01130603" class="uri">https://fred.stlouisfed.org/series/WPU01130603</a></td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">Industrial production index</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/IPUTIL" class="uri">https://fred.stlouisfed.org/series/IPUTIL</a></td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">Wheat and oil</td>
<td align="left">Same as Chapter 1.</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">Eggs (Alberta)</td>
<td align="left"><a href="https://agriculture.canada.ca/en/market-information-system/rp/index-eng.cfm?action=pR&amp;r=16&amp;pdctc=&amp;wbdisable=true" class="uri">https://agriculture.canada.ca/en/market-information-system/rp/index-eng.cfm?action=pR&amp;r=16&amp;pdctc=&amp;wbdisable=true</a></td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">Gasoline (Vancouver)</td>
<td align="left"><a href="https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1810000101" class="uri">https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1810000101</a></td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">Electricity price Index</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/CUUR0000SEHF01" class="uri">https://fred.stlouisfed.org/series/CUUR0000SEHF01</a></td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">Natural gas</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/MHHNGSP" class="uri">https://fred.stlouisfed.org/series/MHHNGSP</a></td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="left">Strawberries</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/APU0000711415" class="uri">https://fred.stlouisfed.org/series/APU0000711415</a></td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="left">Grapes</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/APU0000711417" class="uri">https://fred.stlouisfed.org/series/APU0000711417</a></td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="left">U.S. Mexico exchange</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/EXMXUS" class="uri">https://fred.stlouisfed.org/series/EXMXUS</a></td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="left">Seasonal adjusted gasoline</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/CUSR0000SETB01" class="uri">https://fred.stlouisfed.org/series/CUSR0000SETB01</a></td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="left">Non SA gasoline</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/CUUR0000SETB01" class="uri">https://fred.stlouisfed.org/series/CUUR0000SETB01</a></td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="left">Corn farm price</td>
<td align="left"><a href="https://www.ers.usda.gov/data-products/feed-grains-database/" class="uri">https://www.ers.usda.gov/data-products/feed-grains-database/</a></td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="left">Energy consumption</td>
<td align="left"><a href="https://www.eia.gov/totalenergy/data/monthly/" class="uri">https://www.eia.gov/totalenergy/data/monthly/</a></td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="left">Temperature anomaly</td>
<td align="left"><a href="https://www.ncei.noaa.gov/access/monitoring/national-temperature-index/time-series/anom-tavg/1/12" class="uri">https://www.ncei.noaa.gov/access/monitoring/national-temperature-index/time-series/anom-tavg/1/12</a></td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="left">Hog PPI</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/WPU0132" class="uri">https://fred.stlouisfed.org/series/WPU0132</a></td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="left">U.S. Canada exchange</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/EXCAUS" class="uri">https://fred.stlouisfed.org/series/EXCAUS</a></td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="left">Wood chips</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/PCU3211133211135" class="uri">https://fred.stlouisfed.org/series/PCU3211133211135</a></td>
</tr>
<tr class="odd">
<td align="left">8</td>
<td align="left">Plywood</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/WPU083" class="uri">https://fred.stlouisfed.org/series/WPU083</a></td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="left">Heating Oil</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/WPU05730201" class="uri">https://fred.stlouisfed.org/series/WPU05730201</a></td>
</tr>
<tr class="odd">
<td align="left">9</td>
<td align="left">Vegetable oils</td>
<td align="left"><a href="https://www.worldbank.org/en/research/commodity-markets" class="uri">https://www.worldbank.org/en/research/commodity-markets</a></td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="left">Biodiesel, soyoil</td>
<td align="left"><a href="https://www.card.iastate.edu/research/biorenewables/tools/hist_bio_gm.aspx" class="uri">https://www.card.iastate.edu/research/biorenewables/tools/hist_bio_gm.aspx</a></td>
</tr>
<tr class="odd">
<td align="left">9</td>
<td align="left">Diesel</td>
<td align="left"><a href="http://www.eia.gov/oog/info/wohdp/diesel.asp" class="uri">http://www.eia.gov/oog/info/wohdp/diesel.asp</a></td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="left">Weekly WTI</td>
<td align="left"><a href="https://www.eia.gov/dnav/pet/hist/LeafHandler.ashx?n=PET&amp;s=RWTC&amp;f=W" class="uri">https://www.eia.gov/dnav/pet/hist/LeafHandler.ashx?n=PET&amp;s=RWTC&amp;f=W</a></td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="left">Canada-U.S. crude</td>
<td align="left"><a href="https://economicdashboard.alberta.ca/oilprice" class="uri">https://economicdashboard.alberta.ca/oilprice</a></td>
</tr>
<tr class="even">
<td align="left">10</td>
<td align="left">U.S. dollar index</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/TWEXBGSMTH" class="uri">https://fred.stlouisfed.org/series/TWEXBGSMTH</a></td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="left">Diesel</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/GASDESW" class="uri">https://fred.stlouisfed.org/series/GASDESW</a></td>
</tr>
<tr class="even">
<td align="left">10</td>
<td align="left">Veggie CPI</td>
<td align="left"><a href="https://fred.stlouisfed.org/series/CUSR0000SAF113" class="uri">https://fred.stlouisfed.org/series/CUSR0000SAF113</a></td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="left">California drought</td>
<td align="left"><a href="https://droughtmonitor.unl.edu/DmData/DataTables.aspx?state,ca" class="uri">https://droughtmonitor.unl.edu/DmData/DataTables.aspx?state,ca</a></td>
</tr>
</tbody>
</table>
<p>In addition to the prepared data sets, Chapters 6 and 7 each use simulated data. The code used to generate the simulated data are bundled with the corresponding chapter’s data preparation code.</p>
</div>
<div id="sec:packages" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Data Import and Packages<a href="#sec:packages" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are three common ways to import data into R: (1) API package method; (2) API using URL address; and (3) read data from a locally-stored Excel or csv file. We will use all three methods in this chapter.</p>
<p>The widely used <em>tidyverse</em> package includes <em>readxl</em> and <em>readr</em>. Note that <em>readxl</em> is not part of the core <em>tidyverse</em> package and so it must be loaded using “library(readxl)” even if the <em>tidyverse</em> package has been loaded. In contrast, <em>readr</em> is part of the <em>tidyverse</em> core and so it is not required to use “library(readr)” if the <em>tidyverse</em> package is loaded.</p>
<p>For some of the applications we will use the <em>read_excel()</em> function from the <em>readxl</em> package to read in data from an Excel file. We will use the <em>read_csv()</em> function from the <em>readr</em> package when reading from a csv file. If the date is in text format with a tab separation or some other data format then the <em>read_tsv()</em> or <em>read_delim()</em> functions should be used.</p>
<p>When the data is read in from Excel or csv there is no need to include in the read command a statement which specifies how the data is organized (e.g., sep = ‘,’).</p>
<p>In most cases the top row of the data contains the names of the columns (i.e., the header). If your data does not have a header then you need to use “header = FALSE” in your Excel or csv read statement.</p>
<p>In the older versions of R, it was important to use “stringsAsFactors=FALSE” in the Excel or csv read statement. With current versions of R this restriction is now the default setting and so it is no longer necessary to include this statement when importing data.</p>
<p>If you believe there are white spaces in some of the data (e.g., “re d” instead of “red”) then the data can be read in from Excel or a csv file with “strip.white = TRUE” included in the read statement.</p>
<p>When reading in data the default is for R to assign to “1, 2, 3…” as row names. If you do not wish row names then use “row.names = FALSE” in the read statement.</p>
<p>The four data preparation modules below have a similar format.</p>
<ul>
<li>Import data with an API or read data from Excel or csv into a tibble object.</li>
<li>Convert date columns from character format to R date format if required.</li>
<li>Select columns and dates to retain.</li>
<li>Convert the tibble object to a time series tsibble object.</li>
<li>Merge data sets if required.</li>
</ul>
<p>The data preparation concludes by saving the final tsibble object as a .RDS file. These .RDS files will be imported and used in the empirical applications in the chapters to follow.</p>
<p>The preparation of the four data sets requires a number of packages to be loaded. Packages are typically loaded with the <em>library()</em> function. Rather than specifying a separate library function for each package to be loaded, the <em>p_load()</em> function from R’s <em>pacman</em> package can be used instead. Specifically,</p>
<p><em>pacman::p_load(fpp3, tidyverse, readxl, lubridate, here, janitor, xts, tsibble, forecast, fredr,reshape2)</em></p>
<p>Loading the <em>tidyverse</em> package automatically loads the core set of related packages, which include: <em>ggplot2</em>, <em>dplyr</em>, <em>tidyr</em>, <em>readr</em>, <em>purrr</em>, <em>tibble</em>, <em>stringr</em> and <em>forcats</em>. It was previously noted that although <em>readxl</em> is part of the <em>tidyverse</em> family it is not automatically loaded when <em>tidyverse</em> is loaded. The situation is the same for the <em>lubridate</em> package. The <em>here</em> package is used as part of the R project configuration. The <em>janitor</em> package allows the <em>clean_names()</em> function to be used. The remaining packages, <em>xts</em>, <em>urca</em>, <em>tsibble</em> and <em>forecast</em> are used as part of the time series analysis.</p>
<p>The code for loading the packages for this chapter is as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(fpp3, tidyverse, readxl, lubridate, here, janitor, tsibble, xts, forecast, fredr,fastDummies,fable,reshape2)</span></code></pre></div>
</div>
<div id="sec:applications" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Applications<a href="#sec:applications" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section the data preparation procedures are described for the various empirical application chapters in this textbook (Chapter 1, and Chapters 4 through 11). This section begins with a brief discussion about using APIs to access data.</p>
<div id="accessing-data-with-an-api" class="section level3 hasAnchor" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Accessing Data with an API<a href="#accessing-data-with-an-api" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are many websites which offer subscription-based data APIs for the retrieval of various types of data including commodity prices. Two well known sites include Nasdaq (formerly Quandl) (<a href="https://commodities-api.com/" class="uri">https://commodities-api.com/</a>,<a href="https://data.nasdaq.com/" class="uri">https://data.nasdaq.com/</a>) and EOD Historical Data (<a href="https://eodhistoricaldata.com" class="uri">https://eodhistoricaldata.com</a>). There are also a number of public agencies which offer free data APIs such as the U.S. Bureau of Labour Statistics (<a href="https://www.bls.gov/developers/" class="uri">https://www.bls.gov/developers/</a>) and the <em>FRED</em>, which stands for the <em>Federal Reserve Economic Data</em> (<a href="https://fred.stlouisfed.org/docs/api/fred/" class="uri">https://fred.stlouisfed.org/docs/api/fred/</a>). In the analysis below data APIs from <em>eodhistoricaldata.com</em> and the <em>FRED</em> are used to import data directly into R.</p>
</div>
<div id="chapter-1-monthly-prices-of-crude-oil-and-wheat" class="section level3 hasAnchor" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Chapter 1: Monthly prices of Crude Oil and Wheat<a href="#chapter-1-monthly-prices-of-crude-oil-and-wheat" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The monthly price of West Texas Intermediate (WTI) oil can be imported directly with an API from the Federal Reserve of Economic Data (FRED) website. A free API code can be obtained by selecting <em>FRED Tools – FRED API</em> in the menu bar. The FRED API is easy to use because R has a <em>fredr</em> package which accommodates an intuitive entry of the search and read parameters.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fredr_set_key</span>(<span class="st">&quot;a63c5424469efa8009045b7d02da6a0f&quot;</span>)   </span></code></pre></div>
<p>There are several typical steps for reading in and preparing the FRED data:</p>
<ul>
<li>Filter the data for a start and end date.</li>
<li>Select and possibly rename the desired columns.</li>
<li>Reformat the date column to <em>yearmonth</em> format (this step is used only to improve the appearance of the data and the graphs).</li>
<li>Coerce the object into a <em>tsibble</em> object.</li>
</ul>
<p>The code for importing and preparing FRED data for monthly West Texas Intermediate (WTI) crude oil prices is as follows.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fred_oil <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;MCOILWTICO&quot;</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1986-01-01&quot;</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-11-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date,value) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">P_oil =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month)</span></code></pre></div>
<p>The global price of wheat is also imported from FRED and is prepared using the same procedures as crude oil.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fred_wht <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;PWHEAMTUSDM&quot;</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-01-01&quot;</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-11-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date,value) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">P_wht =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month)</span></code></pre></div>
<p>The crude oil and wheat data sets can now be joined.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>wht_oil <span class="ot">&lt;-</span> fred_wht <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(fred_oil,<span class="at">by=</span><span class="st">&quot;month&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wht_oil) </span></code></pre></div>
<pre><code>## # A tsibble: 6 x 5 [1M]
##   date.x     P_wht    month date.y     P_oil
##   &lt;date&gt;     &lt;dbl&gt;    &lt;mth&gt; &lt;date&gt;     &lt;dbl&gt;
## 1 1990-01-01  168. 1990 Jan 1990-01-01  22.9
## 2 1990-02-01  161. 1990 Feb 1990-02-01  22.1
## 3 1990-03-01  157. 1990 Mar 1990-03-01  20.4
## 4 1990-04-01  159. 1990 Apr 1990-04-01  18.4
## 5 1990-05-01  149. 1990 May 1990-05-01  18.2
## 6 1990-06-01  136. 1990 Jun 1990-06-01  16.7</code></pre>
<p>At the end of this chapter optional code is provide for saving the <em>wht_oil</em> object as an <em>RDS</em> file.</p>
</div>
<div id="chapter-4-part-a-banana-prices" class="section level3 hasAnchor" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Chapter 4 (Part A): Banana Prices<a href="#chapter-4-part-a-banana-prices" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The monthly global price of bananas is read in from an Excel file and converted to a <em>tsibble</em> object as follows.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bananas <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;bananas.xlsx&quot;</span>),<span class="at">sheet =</span> <span class="st">&quot;bananas&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(Month)) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,Price) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bananas)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 2 [1M]
##      month Price
##      &lt;mth&gt; &lt;dbl&gt;
## 1 2002 Sep  0.49
## 2 2002 Oct  0.54
## 3 2002 Nov  0.4 
## 4 2002 Dec  0.63
## 5 2003 Jan  0.56
## 6 2003 Feb  0.46</code></pre>
</div>
<div id="chapter-4-part-b-daily-crude-oil-futures-prices" class="section level3 hasAnchor" number="1.3.4">
<h3><span class="header-section-number">1.3.4</span> Chapter 4 (Part B): Daily Crude Oil Futures Prices<a href="#chapter-4-part-b-daily-crude-oil-futures-prices" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Daily closing prices for commodities can be accessed using the API offered by <em>eodhistoricaldata.com</em>. A free API is available for end-of-day data with the following restrictions: a maximum of 20 API calls per day, and a maximum of one year’s worth of daily data. A trial API allows users to retrieve multiple years of rolling crude oil futures prices. Let’s use this trial API to download several years of daily crude oil futures prices.</p>
<p>Using the instructions from <a href="https://eodhistoricaldata.com" class="uri">https://eodhistoricaldata.com</a>, the trial API token and the symbol for crude oil futures are as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># trial API for crude oil: http://eodhistoricaldata.com</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>api.token <span class="ot">&lt;-</span> <span class="st">&quot;OeAFFmMliFG5orCUuwAKQ8l4WWFQ67YX&quot;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>symbol <span class="ot">&lt;-</span> <span class="st">&quot;CL.COMM&quot;</span></span></code></pre></div>
<p>The following code pulls in daily opening, high, low and closing prices for WTI crude oil for the period January 1, 2017 to December 31, 2021.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ticker.link <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;http://nonsecure.eodhistoricaldata.com/api/eod/&quot;</span>, symbol, <span class="st">&quot;?api_token=&quot;</span>, api.token, <span class="st">&quot;&amp;from=2017-01-01&amp;to=2021-12-31&amp;period=d&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">url</span>(ticker.link))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>##         Date  Open  High   Low Close Adjusted_close Volume
## 1 2017-01-03 54.20 55.24 52.11 52.33          52.33 727793
## 2 2017-01-04 52.49 53.43 52.15 53.26          53.26 512641
## 3 2017-01-05 53.39 54.12 52.79 53.76          53.76 517362
## 4 2017-01-06 53.73 54.32 53.32 53.99          53.99 528333
## 5 2017-01-09 53.75 53.83 51.76 51.96          51.96 564893
## 6 2017-01-10 51.83 52.37 50.71 50.82          50.82 632573</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(data)</span></code></pre></div>
<pre><code>##            Date  Open  High   Low Close Adjusted_close Volume
## 1365 2021-12-23 73.03 73.95 72.27 73.79          73.79 270223
## 1366 2021-12-27 73.38 76.09 72.57 75.57          75.57 268490
## 1367 2021-12-28 75.97 76.92 75.53 75.98          75.98 249728
## 1368 2021-12-29 76.04 77.37 75.36 76.56          76.56 283557
## 1369 2021-12-30 76.58 77.44 75.78 76.99          76.99 231163
## 1370 2021-12-31 76.66 77.08 74.95 75.21          75.21 237118</code></pre>
<p>This API call looks rather complicated but it follows a standard set of API rules. The paste function concatenates three bits of code: the API URL, <a href="http://nonsecure.eodhistoricaldata.com/api/eod/" class="uri">http://nonsecure.eodhistoricaldata.com/api/eod/</a>, the API token and the parameters which indicate that daily data (d) is being requested, beginning on January 1, 2017 and ending on December 31, 2021. This string of concatenated characters is then placed into R’s <em>read.csv</em> function and the data is retrieved.</p>
<p>It is useful to have a csv backup of the daily price data in case the previous API fails. If the backup data is to be used the data has format month-day-year rather than year-month day. This means the code below must be changed accordingly. Let’s import this backup data now.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data_bk <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>,<span class="st">&quot;CL.COMM.csv&quot;</span>))</span></code></pre></div>
<p>To prepare the crude oil prices for formal analysis, it is first necessary to convert the date column from character format to R date format and then convert the data frame into a <em>tsibble</em> object.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>crude_daily <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>Date)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crude_daily)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 7 [1D]
##   Date        Open  High   Low Close Adjusted_close Volume
##   &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;  &lt;int&gt;
## 1 2017-01-03  54.2  55.2  52.1  52.3           52.3 727793
## 2 2017-01-04  52.5  53.4  52.2  53.3           53.3 512641
## 3 2017-01-05  53.4  54.1  52.8  53.8           53.8 517362
## 4 2017-01-06  53.7  54.3  53.3  54.0           54.0 528333
## 5 2017-01-09  53.8  53.8  51.8  52.0           52.0 564893
## 6 2017-01-10  51.8  52.4  50.7  50.8           50.8 632573</code></pre>
</div>
<div id="chapter-4-part-c-cpi-and-potato-prices" class="section level3 hasAnchor" number="1.3.5">
<h3><span class="header-section-number">1.3.5</span> Chapter 4 (Part C): CPI and Potato Prices<a href="#chapter-4-part-c-cpi-and-potato-prices" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The monthly U.S. CPI and an index of the farm price of potatoes can be accessed using the API of the Federal Reserve of Economic Data (FRED).</p>
<p>Let’s import the U.S. CPI from January 1990 to December 2021.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cpi_mnth <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">series_id =</span> <span class="st">&quot;CPIAUCSL&quot;</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-01-01&quot;</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-01&quot;</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>   )</span></code></pre></div>
<p>The FRED CPI data can be prepared and converted into a tsibble object as follows:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cpi_mnth <span class="ot">&lt;-</span> cpi_mnth <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month, value) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">CPI =</span> value)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cpi_mnth)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 2 [1M]
##      month   CPI
##      &lt;mth&gt; &lt;dbl&gt;
## 1 1990 Jan  128.
## 2 1990 Feb  128 
## 3 1990 Mar  129.
## 4 1990 Apr  129.
## 5 1990 May  129.
## 6 1990 Jun  130.</code></pre>
<p>Now let’s use the FRED API to read in the potato price index from January of 2000 to December of 2021.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ppi_potat <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;WPU01130603&quot;</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2000-01-01&quot;</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-01&quot;</span>))</span></code></pre></div>
<p>This potato PPI data can be prepared in the same way that the CPI data was prepared.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ppi_potat <span class="ot">&lt;-</span> ppi_potat <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month, value) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">PPI =</span> value)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ppi_potat)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 2 [1M]
##      month   PPI
##      &lt;mth&gt; &lt;dbl&gt;
## 1 2000 Jan  104.
## 2 2000 Feb  103.
## 3 2000 Mar  104.
## 4 2000 Apr  102.
## 5 2000 May  104 
## 6 2000 Jun  103</code></pre>
</div>
<div id="chapter-5-industrial-production-and-eggs" class="section level3 hasAnchor" number="1.3.6">
<h3><span class="header-section-number">1.3.6</span> Chapter 5: Industrial Production and Eggs<a href="#chapter-5-industrial-production-and-eggs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The empirical applications in Chapter 5 requires five data sets. The first is a measure of monthly U.S. industrial production (electric and gas utilities), the second is the monthly U.S. CPI, the third is a data set which combines the monthly prices of wheat and crude oil and the fourth is the monthly producer price of eggs in the Province of Alberta. The combined wheat- crude oil data and the U.S. CPI were prepared in the previous chapters and so they are excluded from this current round of preparation. The industrial production data comes from the Federal Reserve of Economic Data (FRED). The egg data comes from Agriculture and Agri-Food Canada.</p>
<p>We begin by constructing the industrial production data set. This involves reading in industrial production from FRED, filtering the dates from January of 1990 to December of 2021, reformatting the date column and coercing the data frame to a <em>tsibble</em> object.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>industrial <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;IPUTIL&quot;</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-01-01&quot;</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date,value) </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(industrial)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   date       value
##   &lt;date&gt;     &lt;dbl&gt;
## 1 1990-01-01  71.4
## 2 1990-02-01  70.5
## 3 1990-03-01  71.5
## 4 1990-04-01  72.0
## 5 1990-05-01  72.4
## 6 1990-06-01  73.1</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>industrial <span class="ot">&lt;-</span> industrial <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month, value) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">industrial =</span> value)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(industrial)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 2 [1M]
##      month industrial
##      &lt;mth&gt;      &lt;dbl&gt;
## 1 1990 Jan       71.4
## 2 1990 Feb       70.5
## 3 1990 Mar       71.5
## 4 1990 Apr       72.0
## 5 1990 May       72.4
## 6 1990 Jun       73.1</code></pre>
<p>Reading and preparing the producer price of jumbo eggs in the province of Alberta is more complex. The data for all provinces can be downloaded from the Statistics Canada website one year at a time. The data for each year is stored in a separate worksheet. The data runs from January of 1985 to December of 2021, which is 37 years. Let’s use a loop procedure to read in each workbook and store it as a set of data frames with names <em>y1</em>, <em>y2</em>, etc.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">37</span>) {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> <span class="st">&quot;i&quot;</span>))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>obj <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;Canadian Monthly Egg Prices.xlsx&quot;</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">sheet =</span> year, <span class="at">skip =</span> <span class="dv">9</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">month =</span> dollars_per_dozen,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">price =</span> alberta) <span class="sc">%&gt;%</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">&quot;month&quot;</span>,<span class="st">&quot;price&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(<span class="st">&quot;y&quot;</span>, year, <span class="at">sep=</span><span class="st">&quot;&quot;</span>),obj)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>In this loop the variable <em>year</em>, which takes on values of <em>y1=1</em>, <em>y2=2</em>, etc as <em>i</em> moves through the loop, is used to identify the particular worksheet to read in. The data for a particular year is stored in a vector called <em>obj</em>. The last line of code assigns the data which is stored in the <em>obj</em> vector to a corresponding <em>yi</em> vector (e.g., <em>y1</em> for the 1985 worksheet, <em>y2</em> for the 1986 worksheet, etc.).</p>
<p>The next step is to vertically stack the 37 years of data into long format. There are eloquent ways to do this but to keep things simple a manual <em>rbind()</em> function is used. After the stacking a date vector is created to serve as labels for the respective egg prices.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">rbind</span>(y1,y2,y3,y4,y5,y6,y7,y8,y9,y10,y11,y12,y13,y14,y15,y16,y17,y18,y19,y20,y21,y22,y23,y24,y25,y26,y27,y28,y29,y30,y31,y32,y33,y34,y35,y36,y37)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>date <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">&quot;1985/1/1&quot;</span>), <span class="at">by =</span> <span class="st">&quot;month&quot;</span>, <span class="at">length.out =</span> <span class="dv">444</span>) </span></code></pre></div>
<p>The last step is to merge the price and date vectors and then create a <em>tsibble</em> object out of the resulting data frame.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>eggs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(price,date) <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">price =</span> <span class="fu">as.numeric</span>(price)) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(price,month) </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(eggs)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 2 [1M]
##   price    month
##   &lt;dbl&gt;    &lt;mth&gt;
## 1  1.05 1985 Jan
## 2  1.04 1985 Feb
## 3  1.04 1985 Mar
## 4  1.03 1985 Apr
## 5  1.03 1985 May
## 6  1.02 1985 Jun</code></pre>
</div>
<div id="chapter-6-part-a-gasoline-price" class="section level3 hasAnchor" number="1.3.7">
<h3><span class="header-section-number">1.3.7</span> Chapter 6 (Part A): Gasoline Price<a href="#chapter-6-part-a-gasoline-price" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first data used in this chapter is the monthly price of unleaded gasoline in Vancouver, Canada.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>vancouver <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>, <span class="st">&quot;18100001.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(GEO<span class="sc">==</span><span class="fu">c</span>(<span class="st">&quot;Vancouver, British Columbia&quot;</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>             Type.of.fuel<span class="sc">==</span><span class="st">&quot;Premium unleaded gasoline at self service filling stations&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">rename</span>(<span class="at">Vancouver =</span> VALUE) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>           dplyr<span class="sc">::</span><span class="fu">select</span>(REF_DATE,Vancouver)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>winnipeg <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>, <span class="st">&quot;18100001.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(GEO<span class="sc">==</span><span class="fu">c</span>(<span class="st">&quot;Winnipeg, Manitoba&quot;</span>),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>             Type.of.fuel<span class="sc">==</span><span class="st">&quot;Premium unleaded gasoline at self service filling stations&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">Winnipeg =</span> VALUE) <span class="sc">%&gt;%</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(REF_DATE,Winnipeg)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>gas_city <span class="ot">&lt;-</span> vancouver <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(winnipeg, <span class="at">by=</span><span class="st">&quot;REF_DATE&quot;</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">ym</span>(REF_DATE),</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">yearmonth</span>(month),</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">premium =</span> Vancouver<span class="sc">-</span>Winnipeg) <span class="sc">%&gt;%</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(month,Vancouver,Winnipeg,premium) <span class="sc">%&gt;%</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">&quot;2000-01&quot;</span> <span class="sc">~</span> .)</span></code></pre></div>
</div>
<div id="chapter-6-part-b-electricity---natural-gas-margin" class="section level3 hasAnchor" number="1.3.8">
<h3><span class="header-section-number">1.3.8</span> Chapter 6 (Part B): Electricity - Natural Gas Margin<a href="#chapter-6-part-b-electricity---natural-gas-margin" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The second data used in this chapter consists of a calculated monthly “spark spread”, which is the wholesale price of electricity minus the wholesale price of natural gas multiplied by a conversion factor. The spark spread can be viewed as the gross margin earned by plants which produce electricity from natural gas. The electricity price is the monthly average of the Intercontinental Exchange (ICE) daily wholesale spot prices of “Mid C Peak” electricity ($/MWh). The Mid C Peak price is the price for electricity delivered to the Mid Columbia Trading Hub in the U.S. Pacific Northwest. This data set runs from June of 2001 to December of 2021.</p>
<p>The Federal Reserve of Economic Data (FRED) has data on the Henry Hub natural gas spot price (dollars per million BTU) for the June of 2001 to December of 2021 period. Henry Hub refers to the price established at a major natural gas trading hub near Erath, Louisiana. The price of natural gas at Malin (in Northern California) is a more appropriate price but daily data at this location is available for the years 2015, 2016 and 2017 only. We proceed by calculating the daily percent price difference for Malin and Henry Hub natural gas, and using this calculated percentage to adjust the monthly Henry Hub price to more accurately reflect the prevailing price in the Pacific Northwest.</p>
<p>The daily gas prices at Malin and Henry Hub are in separate Excel files for the years 2015, 2016 and 2017. We begin by importing these files, filtering the Malin and Henry Hub prices, joining the filtered data and then calculating the log of the Henry Hub price minus the log of the Malin price.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>d2015_gas <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;ice_natgas-2015final.xls&quot;</span>),</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;2015&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>d2016_gas <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;ice_natgas-2016final.xls&quot;</span>),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;2016&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>d2017_gas <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;ice_natgas-2017final.xlsx&quot;</span>),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;2017&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>gas_mailin <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d2015_gas,d2016_gas,d2017_gas) <span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price_hub <span class="sc">==</span> <span class="st">&quot;Malin&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">malin_day =</span> wtd_avg_price_mm_btu) <span class="sc">%&gt;%</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(trade_date,malin_day)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>gas_henry <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d2015_gas,d2016_gas,d2017_gas) <span class="sc">%&gt;%</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price_hub <span class="sc">==</span> <span class="st">&quot;Henry&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">henry_day =</span> wtd_avg_price_mm_btu) <span class="sc">%&gt;%</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(trade_date,henry_day)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>compare_daily <span class="ot">&lt;-</span> gas_mailin <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(gas_henry,<span class="at">by=</span><span class="st">&quot;trade_date&quot;</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>compare_daily <span class="ot">&lt;-</span> compare_daily <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">discount =</span> <span class="fu">log</span>(henry_day)<span class="sc">-</span><span class="fu">log</span>(malin_day))</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>discount <span class="ot">&lt;-</span> <span class="fu">mean</span>(compare_daily<span class="sc">$</span>discount)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>discount</span></code></pre></div>
<pre><code>## [1] 0.053047</code></pre>
<p>The next step is to import the “Mid C Hub” electricity prices. These prices are in a dedicated <em>Mid C Hub</em> file for the years 2001 to 2013, and must be filtered out of individual year files for 2014 to 2021. After importing and filtering, the daily prices can be stacked to create a complete data set from June of 2001 to December of 2021.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import data from &quot;Mid-C Hub&quot; file</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>d2001_2013 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;MID-C Hub.xls&quot;</span>),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;Sheet1&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># import individual year files, stack them and filter out &quot;Mid-C Hub&quot;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>d2014 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;ice_electric-2014final.xls&quot;</span>),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;2014&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>d2015 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;ice_electric-2015final.xls&quot;</span>),</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;2015&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>d2016 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;ice_electric-2016final.xls&quot;</span>),</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;2016&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>d2017 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;ice_electric-2017final.xlsx&quot;</span>),</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;2017&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>d2018 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;ice_electric-2018final.xlsx&quot;</span>),</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;2018&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>d2019 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;ice_electric-2019final.xlsx&quot;</span>),</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;2019&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>d2020 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;ice_electric-2020final.xlsx&quot;</span>),</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;2020&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>d2021 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/electricity&quot;</span>, <span class="st">&quot;ice_electric-2021final.xlsx&quot;</span>),</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">&quot;2021&quot;</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>elec_daily_new <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d2014,d2015,d2016,d2017,d2018,d2019,d2020,d2021) <span class="sc">%&gt;%</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price_hub <span class="sc">==</span> <span class="st">&quot;Mid C Peak&quot;</span>)</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="co"># stock two sets of daily prices and rename the price variable</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>elec_daily <span class="ot">&lt;-</span> <span class="fu">rbind</span>(elec_daily_new,d2001_2013) <span class="sc">%&gt;%</span></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">day_price =</span> wtd_avg_price_m_wh) <span class="sc">%&gt;%</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(trade_date,day_price)</span></code></pre></div>
<p>The next step is to aggregate the daily electricity price data into monthly averages. There are three months of missing data and so the <em>fill_gaps()</em> function is used to impute these missing values. After this adjustment, the monthly averages are seasonally adjusted.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>elect_month <span class="ot">&lt;-</span> elec_daily <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(trade_date)) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">month_price =</span> <span class="fu">mean</span>(day_price)) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">&quot;2001-06&quot;</span> <span class="sc">~</span> .)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>electricity <span class="ot">&lt;-</span> tsibble<span class="sc">::</span><span class="fu">fill_gaps</span>(elect_month)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>x11_dcmp <span class="ot">&lt;-</span> electricity <span class="sc">%&gt;%</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">x11 =</span> <span class="fu">X_13ARIMA_SEATS</span>(month_price <span class="sc">~</span> <span class="fu">x11</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() </span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>electricity_sa <span class="ot">&lt;-</span> electricity <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">elect_sa =</span> x11_dcmp<span class="sc">$</span>trend<span class="sc">+</span>x11_dcmp<span class="sc">$</span>irregular) <span class="sc">%&gt;%</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,elect_sa) </span></code></pre></div>
<p>We now import the Henry Hub monthly natural gas price from FRED, and do the seasonal adjustment.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fredr_set_key</span>(<span class="st">&quot;a63c5424469efa8009045b7d02da6a0f&quot;</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>gas<span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;MHHNGSP&quot;</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1997-01-01&quot;</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-10-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gas =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,gas) <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>x11_dcmp <span class="ot">&lt;-</span> gas <span class="sc">%&gt;%</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">x11 =</span> <span class="fu">X_13ARIMA_SEATS</span>(gas <span class="sc">~</span> <span class="fu">x11</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>()</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>gas_sa <span class="ot">&lt;-</span> gas <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">gas_sa =</span> x11_dcmp<span class="sc">$</span>trend<span class="sc">+</span>x11_dcmp<span class="sc">$</span>irregular) <span class="sc">%&gt;%</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,gas_sa)</span></code></pre></div>
<p>The last step is to join the electricity and gas seasonally adjusted price and then calculate the spark spread. The spark spread is calculated as:</p>
<p><em>Spark spread (<span class="math inline">\(/MWh) = power price (\)</span>/MWh) – [natural gas price ($/mmBtu) heat rate (mmBtu/MWh)] </em>. The Energy Information Administration (EIA) recommends a heat rate coefficient equal to 7,000 Btu/kilowatthour (kWh), which is equivalent to 7 mmBTU/MWh. When applying this formula we must multiply the natural gas price by <em>1 - discount</em> where <em>discount</em> was calculated above.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> gas_sa <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(electricity_sa, <span class="at">by=</span><span class="st">&quot;month&quot;</span>) </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> power <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SprkSprd =</span> elect_sa <span class="sc">-</span> (gas_sa<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>discount)<span class="sc">*</span><span class="dv">7</span>))</span></code></pre></div>
</div>
<div id="chapter-6-part-c-simulated-structural-break-data" class="section level3 hasAnchor" number="1.3.9">
<h3><span class="header-section-number">1.3.9</span> Chapter 6 (Part C): Simulated Structural Break Data<a href="#chapter-6-part-c-simulated-structural-break-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Chapter 6 requires simulate trend stationary data with a two separate breaks in the intercept of stochastic process. The following code randomly creates this data and stores the 18 simulated observations as an <em>RDS</em> file.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">40</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">18</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> .<span class="dv">25</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>del2 <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>del3 <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>gam <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co">#unit &lt;- matrix(1,T,1)</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co">#trnd &lt;- seq(1,T)</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">#V &lt;- as.matrix(cbind(unit,trnd))</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>poly1 <span class="ot">&lt;-</span> a<span class="sc">*</span><span class="fu">seq</span>(<span class="dv">1</span>,T<span class="sc">/</span><span class="dv">3</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> b<span class="sc">*</span><span class="fu">seq</span>(<span class="dv">1</span>, T<span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> c  </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>poly2 <span class="ot">&lt;-</span> poly1 <span class="sc">+</span> poly1[T<span class="sc">/</span><span class="dv">3</span>] <span class="sc">+</span> del2</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>poly3 <span class="ot">&lt;-</span> poly1 <span class="sc">+</span> poly2[T<span class="sc">/</span><span class="dv">3</span>] <span class="sc">+</span> del3</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">c</span>(poly1,poly2,poly3)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> poly <span class="sc">+</span> gam<span class="sc">*</span><span class="fu">rnorm</span>(T)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>break_simulate <span class="ot">&lt;-</span> w</span></code></pre></div>
</div>
<div id="chapter-7-fruit-corn-energy-hogs-and-exchange-rate" class="section level3 hasAnchor" number="1.3.10">
<h3><span class="header-section-number">1.3.10</span> Chapter 7: Fruit, Corn, Energy, Hogs and Exchange Rate<a href="#chapter-7-fruit-corn-energy-hogs-and-exchange-rate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The analysis in this chapter uses the following monthly U.S. data sets:</p>
<ul>
<li>Strawberry price.</li>
<li>Grape price.</li>
<li>U.S. dollar - Mexican pesos exchange rate.</li>
<li>U.S. - Canada dollar exchange rate.</li>
<li>Price of corn received by farmers</li>
<li>Temperature anomaly (i.e., deviation from long term average).</li>
<li>Energy consumption.</li>
<li>Electricity price index.</li>
<li>Slaughter hog PPI.</li>
</ul>
<p>The first three data sets are merged to create a combined fruit data set. The corn price and U.S. - Mexico exchange rate are bundled into the corn data set. Temperature, energy consumption and the electricity price index are combined into a single data set. The slaughter hog PPI is combined with the price of crude oil (previously imported) and the U.S. - Canada and U.S. - Mexico exchange rates..</p>
<p><strong>U.S. Strawberry and Grape Prices</strong></p>
<p>We begin by reading in monthly U.S. prices for strawberries and grapes from FRED. The date range is restricted to January of 2001 to September of 2021. Some of the observations in these two data series have a <em>NA</em>, which indicates “not available”. The <em>na.approx()</em> function replaces each <em>NA</em> with a value that is calculated using linear interpolation. This function does not work if the first observation is an <em>NA</em>, which is the case for the strawberry price series. To get around this problem observations prior to January of 2001 are inital read in, and these three values are deleted after the <em>NA</em> values have been replaced.</p>
<p>After renaming each price variable the data is coerced into a <em>tsibble</em> object.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fred_straw <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;APU0000711415&quot;</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2000-10-01&quot;</span>),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-9-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">value =</span> <span class="fu">na.approx</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">strawberry =</span>value) <span class="sc">%&gt;%</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,strawberry)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>fred_grape <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;APU0000711417&quot;</span>,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2001-01-01&quot;</span>),</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-9-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date),</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">value =</span> <span class="fu">na.approx</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">grape =</span>value) <span class="sc">%&gt;%</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,grape)</span></code></pre></div>
<p>The next step is to import from FRED the the U.S. dollar – Mexican peso monthly exchange rate. The imported data is prepared in the usual way.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a> ex_mex <span class="ot">&lt;-</span>  <span class="fu">fredr</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;EXMXUS&quot;</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1980-01-01&quot;</span>),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-8-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ex_mex =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,ex_mex) <span class="sc">%&gt;%</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month)</span></code></pre></div>
<p>The last step is to merge the strawberry price, grape price and exchange rate data.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fruit <span class="ot">&lt;-</span> fred_straw <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(fred_grape, <span class="at">by =</span> <span class="st">&quot;month&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., ex_mex, <span class="at">by =</span> <span class="st">&quot;month&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mnth_ind =</span> <span class="fu">month</span>(month),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(month)) </span></code></pre></div>
<p><strong>Gasoline Price (With and Without Seasonal Adjustments) </strong></p>
<p>The data for the seasonally adjusted and non-adjusted U.S. gasoline price (monthly) is imported from FRED. Along with the import the usual data preparation tips are applied. We will used a capital letter on the variable name to indicate that the series has been seasonally adjusted.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a> fred_gasSA <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;CUSR0000SETB01&quot;</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2000-01-01&quot;</span>),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-8-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Gasoline =</span>value) <span class="sc">%&gt;%</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,Gasoline) </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>fred_gas <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;CUUR0000SETB01&quot;</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2000-01-01&quot;</span>),</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-8-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gasoline =</span>value) <span class="sc">%&gt;%</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,gasoline) </span></code></pre></div>
<p>The two gasoline data series can now be merged.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>gasoline <span class="ot">&lt;-</span> fred_gasSA <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(fred_gas, <span class="at">by =</span> <span class="st">&quot;month&quot;</span>) </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gasoline)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 3 [1M]
##      month Gasoline gasoline
##      &lt;mth&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 2000 Jan     116.     112.
## 2 2000 Feb     120.     117.
## 3 2000 Mar     133.     131.
## 4 2000 Apr     126.     128.
## 5 2000 May     124.     128.
## 6 2000 Jun     135.     138.</code></pre>
<p><strong>Price of Corn Received by U.S. Farmers </strong>
The corn price data is imported from an Excel workbook. Preparation consists of selecting the columns, creating a new date column and then filtering the dates.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>corn <span class="ot">&lt;-</span>  <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>, <span class="st">&quot;corn.xlsx&quot;</span>),<span class="at">sheet =</span> <span class="st">&quot;Feed_Grains_Excel&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month_ind =</span> <span class="fu">match</span>(Frequency,month.abb),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">as.yearmon</span>(<span class="fu">paste</span>(Year, month_ind), <span class="st">&quot;%Y %m&quot;</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">yearmonth</span>(<span class="fu">as.Date</span>(month))) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">corn =</span> Amount) <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,month_ind,Year,corn) <span class="sc">%&gt;%</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> month) <span class="sc">%&gt;%</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">&quot;1980 Jan&quot;</span><span class="sc">~</span>.)</span></code></pre></div>
<p>The next step is to create a new table which is the average annual price. This annual average is used to calculate the monthly deviation from the annual average in the original data frame.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>year_mean <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(corn) <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">avg_yr =</span> <span class="fu">mean</span>(corn, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>corn <span class="ot">&lt;-</span> corn <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(year_mean,<span class="at">by=</span><span class="st">&quot;Year&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deviate =</span> corn <span class="sc">-</span> avg_yr)</span></code></pre></div>
<p>The last step is to add the U.S. dollar – Mexican Peso exchange rate to the corn data frame.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>corn <span class="ot">&lt;-</span> corn <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(ex_mex, <span class="at">by =</span> <span class="st">&quot;month&quot;</span>)</span></code></pre></div>
<p><strong>Temperature Anomaly Data</strong></p>
<p>A temperature anomaly is the average temperture for the current month minus the long term average for that month. The temperature anomaly data resides in 12 worksheets of an Excel workbook, with a worksheet corresponding to each month. For example, the “Jan” worksheet contains the temperature anomaly data for each year from 1895 to 2022. Let’s begin by importing the 12 data sets.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>jan <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Jan&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;01&quot;</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>feb <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Feb&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;02&quot;</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>mar <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Mar&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;03&quot;</span>)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>apr <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Apr&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;04&quot;</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>may <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;May&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;05&quot;</span>)</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>jun <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Jun&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;06&quot;</span>)</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>jul <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Jul&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;07&quot;</span>)</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>aug <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Aug&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;08&quot;</span>)</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>sep <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Sep&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;09&quot;</span>)</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>oct <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Oct&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;10&quot;</span>)</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>nov <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Nov&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;11&quot;</span>)</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>dec <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temperature.xlsx&quot;</span>),</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Dec&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month=</span><span class="st">&quot;12&quot;</span>)</span></code></pre></div>
<p>The 12 data sets can now be combined using <em>year</em> as the common variable. The <em>arrange()</em> function is used to convert the wide data into the desired long data format (i.e., a format with the monthly temperature anomaly data stacked rather than placed side-by-side).</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(jan,feb,mar,apr,may,jun,jul,aug,sep,oct,nov,dec) <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Year=</span>Date) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year=</span><span class="fu">as.numeric</span>(Year),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month=</span><span class="fu">as.numeric</span>(Month),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Date=</span><span class="fu">make_date</span>(Year,Month),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">month=</span><span class="fu">yearmonth</span>(Date)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span><span class="fu">arrange</span>(temp, Year, Month) <span class="sc">%&gt;%</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year<span class="sc">&gt;=</span><span class="dv">1986</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="fu">n</span>())</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(temp2)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##    Year ClimDiv USCRN Month Date          month
##   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;        &lt;mth&gt;
## 1  1986    2.33 -100.     1 1986-01-01 1986 Jan
## 2  1986    0.2  -100.     2 1986-02-01 1986 Feb
## 3  1986    2.61 -100.     3 1986-03-01 1986 Mar
## 4  1986    1.01 -100.     4 1986-04-01 1986 Apr
## 5  1986    0.03 -100.     5 1986-05-01 1986 May
## 6  1986    0.91 -100.     6 1986-06-01 1986 Jun</code></pre>
<p><strong>Merge with Energy Consumption Data and Electricity Price Data</strong></p>
<p>Energy consumption data, which runs from January 1973 to April 2022, consists of monthly U.S. residential energy use. Let’s read in this data from a csv file and then convert the imported data into a <em>tsibble</em> object.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ener_dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>,<span class="st">&quot;energy.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> month) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,energy)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ener_dat)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 2 [1M]
##      month energy
##      &lt;mth&gt;  &lt;dbl&gt;
## 1 1973 Jan  1339.
## 2 1973 Feb  1175.
## 3 1973 Mar   983.
## 4 1973 Apr   715.
## 5 1973 May   536.
## 6 1973 Jun   367.</code></pre>
<p>The electricity price index is imported from FRED.
The seasonally adjusted version of this data was imported above.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fredr_set_key</span>(<span class="st">&quot;a63c5424469efa8009045b7d02da6a0f&quot;</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>elect<span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;CUUR0000SEHF01&quot;</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1990-01-01&quot;</span>),</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-08-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">elect_nom =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,elect_nom) </span></code></pre></div>
<p>We will work with the real price of electricity and so let’s add the U.S. all-items CPI to the previous electricity data frame and then calculate a real price of electricity.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>elect <span class="ot">&lt;-</span> elect <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(cpi_mnth,<span class="at">by=</span><span class="st">&quot;month&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">electricity =</span> <span class="dv">100</span><span class="sc">*</span>elect_nom<span class="sc">/</span>CPI)</span></code></pre></div>
<p>The energy consumption, electricity price and temperature anomaly data can now be merged.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>energy_temp <span class="ot">&lt;-</span> ener_dat <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(temp2,<span class="at">by=</span><span class="st">&quot;month&quot;</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., elect, <span class="at">by=</span><span class="st">&quot;month&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,energy,electricity,ClimDiv) <span class="sc">%&gt;%</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">temperature=</span>ClimDiv) <span class="sc">%&gt;%</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(energy_temp)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 4 [1M]
##      month energy electricity temperature
##      &lt;mth&gt;  &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 1990 Mar   750.        88.9        1.17
## 2 1990 Apr   572.        88.9        0.67
## 3 1990 May   405.        89.7       -2.2 
## 4 1990 Jun   307.        94.1        0.73
## 5 1990 Jul   272.        93.5       -1.15
## 6 1990 Aug   278.        92.6       -0.8</code></pre>
<p><strong>Slaughter Hog and Exchange Rate Data</strong></p>
<p>The data set for the last analysis in Chapter 6 consists of the slaughter hog producer price index, the price of WTI crude oil (previously imported), the U.S. - Canada exchange rate. These data series can be imported from the FRED database.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>hogs <span class="ot">&lt;-</span>  <span class="fu">fredr</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;WPU0132&quot;</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1986-01-01&quot;</span>),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">hogs =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,hogs) <span class="sc">%&gt;%</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a> ex_can <span class="ot">&lt;-</span>  <span class="fu">fredr</span>(</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;EXCAUS&quot;</span>,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1986-01-01&quot;</span>),</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ex_can =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,ex_can) <span class="sc">%&gt;%</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month)</span></code></pre></div>
<p>This pair of data sets should be merged with the previously imported price of WTI crude oil (fred_oil) and the U.S. - Mexican exchange rate (ex_mex). The resulting data frame should then be coerced into a <em>tsibble</em> object.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>hogs <span class="ot">&lt;-</span> hogs <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(ex_can, <span class="at">by =</span> <span class="st">&quot;month&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(fred_oil, <span class="at">by=</span><span class="st">&quot;month&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">oil =</span> P_oil) <span class="sc">%&gt;%</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date)</span></code></pre></div>
</div>
</div>
<div id="chapter-7-simulated-arima-data" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Chapter 7: Simulated ARIMA Data<a href="#chapter-7-simulated-arima-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Chapter 7 will make uses of quarterly ARIMA(1,1,1) simulated data. The simulation creates the raw ARIMA data series using the <em>arima.sim()</em> function and merges this data with a date sequence.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>set.seed <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">ar =</span> <span class="fl">0.8</span>, <span class="at">ma =</span> <span class="fl">0.2</span>), <span class="at">n =</span> <span class="dv">80</span>) </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2002/1/1&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2022/1/1&quot;</span>), <span class="at">by =</span> <span class="st">&quot;quarter&quot;</span>) </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(<span class="fu">tibble</span>(seq),<span class="fu">tibble</span>(Z)) <span class="sc">%&gt;%</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">quarter =</span> <span class="fu">yearquarter</span>(seq)) <span class="sc">%&gt;%</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>quarter) <span class="sc">%&gt;%</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(quarter,Z) </span></code></pre></div>
<p>The next step is to generate an exogenous <em>x</em> variable which is correlated with the ARIMA series. As well, a second ARIMA series is created by adding seasonal components to the first ARIMA series.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> data_sim <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rnd1 =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">rnorm</span>(<span class="dv">81</span>),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">rnd2 =</span> <span class="fu">rnorm</span>(<span class="dv">81</span>),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="dv">20</span> <span class="sc">+</span> <span class="fl">0.8</span><span class="sc">*</span>Z <span class="sc">+</span> rnd1,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">qtr =</span> <span class="fu">quarter</span>(quarter),</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">s1 =</span> <span class="fu">ifelse</span>(qtr<span class="sc">==</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">5</span> <span class="sc">+</span>rnd2,<span class="dv">0</span>),</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">s2 =</span> <span class="fu">ifelse</span>(qtr<span class="sc">==</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">2</span> <span class="sc">+</span>rnd2,<span class="dv">0</span>),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">s3 =</span> <span class="fu">ifelse</span>(qtr<span class="sc">==</span><span class="dv">3</span>, <span class="dv">2</span> <span class="sc">+</span>rnd2,<span class="dv">0</span>),</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">s4 =</span> <span class="fu">ifelse</span>(qtr<span class="sc">==</span><span class="dv">3</span>, <span class="dv">2</span> <span class="sc">+</span>rnd2,<span class="dv">0</span>),</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> Z <span class="sc">+</span> s1 <span class="sc">+</span> s2 <span class="sc">+</span> s3 <span class="sc">+</span> s4) <span class="sc">%&gt;%</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(quarter,Z,z,x)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_sim)   </span></code></pre></div>
<pre><code>## # A tsibble: 6 x 4 [1Q]
##   quarter     Z     z     x
##     &lt;qtr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 2002 Q1  0    -4.89  20.7
## 2 2002 Q2  3.42  1.97  25.4
## 3 2002 Q3  5.55  8.76  27.6
## 4 2002 Q4  7.43  7.43  25.8
## 5 2003 Q1  9.93  6.14  31.7
## 6 2003 Q2 12.7  11.8   30.5</code></pre>
<div id="chapter-8-woodchips-and-heating-oil" class="section level3 hasAnchor" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Chapter 8: Woodchips and Heating Oil<a href="#chapter-8-woodchips-and-heating-oil" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The wood-energy data set consists of the prices of wood chips, plywood, heating oil and crude oil. Similar to the import procedure used for potato prices in Chapter 6, the four prices in this data set are imported from the FRED website via an api (the data for crude oil was previously imported but it will be repeated here because the start data is earlier). Preparing this data involves filtering the data to begin in January of 1986 and ending in April of 2022. As well, a descriptive name of each time series is used to replace “value” as the series name.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import crude oil prices from FRED</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>crude_day <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;DCOILWTICO&quot;</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1986-01-01&quot;</span>),</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-04-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date,value) <span class="sc">%&gt;%</span> </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">crude_day =</span> value)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co"># import chip prices from FRED</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>chips <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;PCU3211133211135&quot;</span>,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1986-01-01&quot;</span>),</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-04-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date,value) <span class="sc">%&gt;%</span> </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">chips_lev =</span> value,</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> date)</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="co"># import plywood prices from FRED</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>plywood <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;WPU083&quot;</span>,</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1986-01-01&quot;</span>),</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-04-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date,value) <span class="sc">%&gt;%</span> </span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">plywood_lev =</span> value,</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> date)</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="co"># import heating oil prices from FRED</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>heat <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;WPU05730201&quot;</span>,</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1986-01-01&quot;</span>),</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-04-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date,value) <span class="sc">%&gt;%</span> </span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">heat_lev =</span> value,</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> date)</span></code></pre></div>
<p>An additional preparation step is required because the fourth data series (crude oil prices) arrives in daily format rather than monthly format. The daily data is aggregated into monthly average prices for crude oil as follows.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>crude_day <span class="ot">&lt;-</span> crude_day[<span class="fu">complete.cases</span>(crude_day),] </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>crude <span class="ot">&lt;-</span> crude_day <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">crude_lev =</span> <span class="fu">mean</span>(crude_day))</span></code></pre></div>
<p>The four imported prices for wood chips, plywood, heating oil and crude oil can now be merged and the resulting data frame can then be coerced into a <em>tsibble</em> time series object.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>wood <span class="ot">&lt;-</span> chips <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(plywood, <span class="at">by =</span> <span class="st">&quot;month&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(heat, <span class="at">by =</span> <span class="st">&quot;month&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(crude, <span class="at">by =</span> <span class="st">&quot;month&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) </span></code></pre></div>
<p>This wood - energy data set will be used in Chapter 7 to estimate a vector autoregression (VAR) model with price premium variables. The wood chip price premium is the log of the difference between the price of wood chips and the price of plywood (recall that the log of the price difference is approximately equal to the percent difference). The heating oil price premium is the log of the difference between the price of heating oil and the price of crude oil. Let’s add these two price premium variables to our data set and then deselect the original price variables.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>wood <span class="ot">&lt;-</span> wood <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">premE=</span><span class="fu">log</span>(heat_lev<span class="sc">-</span>crude_lev),</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">premW=</span><span class="fu">log</span>(plywood_lev<span class="sc">-</span>chips_lev)) <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,premE,premW)</span></code></pre></div>
<p>The price premium data requires a month variable for the purpose of creating seasonality variables. The month variable is added as follows.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>wood <span class="ot">&lt;-</span> wood <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(month, <span class="st">&quot;%m&quot;</span>)))</span></code></pre></div>
<p>The final step is to merge the price premium data sets with the temperature anomaly data which was created in Chapter 6.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>wood <span class="ot">&lt;-</span> wood <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp=</span>temp2<span class="sc">$</span>ClimDiv) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">L.temp=</span><span class="fu">lag</span>(temp),</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">L2.temp=</span><span class="fu">lag</span>(temp,<span class="dv">2</span>))</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wood)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 7 [1D]
##   month      premE premW period  temp L.temp L2.temp
##   &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 1986-01-01  4.10  2.58      1  2.33  NA      NA   
## 2 1986-02-01  3.83  2.54      2  0.2    2.33   NA   
## 3 1986-03-01  3.72  2.69      3  2.61   0.2     2.33
## 4 1986-04-01  3.63  2.97      4  1.01   2.61    0.2 
## 5 1986-05-01  3.52  2.87      5  0.03   1.01    2.61
## 6 1986-06-01  3.48  2.77      6  0.91   0.03    1.01</code></pre>
</div>
<div id="chapter-9-vegetable-oils-and-biofuels" class="section level3 hasAnchor" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> Chapter 9: Vegetable Oils and Biofuels<a href="#chapter-9-vegetable-oils-and-biofuels" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This data set consists of the monthly prices of soybeans, rapeseed, palm oil. These are prices are extracted from a large World Bank data set. The monthly data runs from January 1960 to the current month. Importing the World Bank data into R is complicated for several reasons: (1) the column names reside in row 7; (2) the column names are in all capital letters; (3) there is no name for the date column; and (4) missing data is identified with “..” rather than “na”.</p>
<p>The <em>clean_names()</em> function will convert capital letters to small letters in the column names, and will also assign “x1” as the name for the date column. Assigning <em>skip = 6</em> and <em>na = “..”</em> ensures that the first six rows are skipped when reading the data, and all occurrences of “..” are converted to “na”. Let’s import the data now.</p>
<p>Using these procedures the data can be imported as follows.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>cmo <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>, <span class="st">&quot;CMO-Historical-Data-Monthly.xlsx&quot;</span>),</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sheet =</span> <span class="st">&quot;Monthly Prices&quot;</span>, <span class="at">skip =</span> <span class="dv">6</span>, <span class="at">na =</span> <span class="st">&quot;..&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span></code></pre></div>
<pre><code>## New names:
## • `` -&gt; `...1`</code></pre>
<p>The date format in the imported data is a little unusual (e.g., “1960M01”). Nevertheless, the <em>ym()</em> function from R’s lubridate package is able to manage this conversion (note that the “x1” date column is renamed “month”). A filter function is used to select the rows which correspond to January of 2003 to December of 2021.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>cmo <span class="ot">&lt;-</span> cmo <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">month =</span> x1) <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month, palm_oil, soybean_oil, rapeseed_oil) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">ym</span>(month)) <span class="sc">%&gt;%</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">&quot;2003-01-01&quot;</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">&quot;2020-12-01&quot;</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(cmo)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   month      palm_oil soybean_oil rapeseed_oil
##   &lt;date&gt;        &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
## 1 2003-01-01     486.        541.         624.
## 2 2003-02-01     477.        522.         586.
## 3 2003-03-01     454.        523.         552.
## 4 2003-04-01     443.        541.         557.
## 5 2003-05-01     454.        549.         607.
## 6 2003-06-01     466.        546.         612.</code></pre>
<p>The final step is to reformat the month column to make it more readable. The reformatted month column can now serve as the index when coercing the imported data frame into a <em>tsibble</em> time series object.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>cmo <span class="ot">&lt;-</span> cmo <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(month)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> month) <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month, <span class="fu">everything</span>()) </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(cmo)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 4 [1M]
##      month palm_oil soybean_oil rapeseed_oil
##      &lt;mth&gt;    &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
## 1 2003 Jan     486.        541.         624.
## 2 2003 Feb     477.        522.         586.
## 3 2003 Mar     454.        523.         552.
## 4 2003 Apr     443.        541.         557.
## 5 2003 May     454.        549.         607.
## 6 2003 Jun     466.        546.         612.</code></pre>
<p>The next data set to be created requires combining the weekly price of soybean oil and biodiesel, regular diesel and crude oil. The first pair of prices will be imported from an csv file and the second pair from individual Excel files. An inner join is used to merge these three data sets. The final data set runs from week 2 of 1994 to week 2 of 2022.</p>
<p>When reading in the soybean oil and biodiesel data, the first two rows are skipped and the first two columns, which contain the desired prices, are selected. The names of the two columns are then changed. Finally, the date which is imported in character format is converted to an R date format using the <em>mdy()</em> function. The procedure for reading in the price of diesel from one of the Excel files and the price of crude oil from the second Excel file is similar.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>iowa_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>, <span class="st">&quot;hist_bio_gm.csv&quot;</span>), <span class="at">skip =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">date =</span> <span class="dv">1</span>, <span class="at">biodiesel =</span> <span class="dv">2</span>, <span class="at">soyoil =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">mdy</span>(date)) <span class="co"># convert character to date format</span></span></code></pre></div>
<pre><code>## Rows: 775 Columns: 7
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): Date
## dbl (6): Biodiesel Price ($/gallon), Soybean Oil Price (cents/pound), Methan...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iowa_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   date       biodiesel soyoil
##   &lt;date&gt;         &lt;dbl&gt;  &lt;dbl&gt;
## 1 2007-04-13      3.1    29.9
## 2 2007-04-20      3.1    29.3
## 3 2007-04-27      3.08   30.2
## 4 2007-05-04      3.14   31.1
## 5 2007-05-11      3.14   31.1
## 6 2007-05-18      3.18   32.9</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>diesel_data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>,<span class="st">&quot;Diesel Fuel Prices-EIA.xls&quot;</span>), <span class="at">sheet =</span> <span class="st">&quot;Data 1&quot;</span>, <span class="at">skip =</span> <span class="dv">2</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">date =</span> <span class="dv">1</span>, <span class="at">diesel =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ymd</span>(date))</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(diesel_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   date       diesel
##   &lt;date&gt;      &lt;dbl&gt;
## 1 1994-03-21   1.11
## 2 1994-03-28   1.11
## 3 1994-04-04   1.11
## 4 1994-04-11   1.11
## 5 1994-04-18   1.10
## 6 1994-04-25   1.11</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>crude_data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>,<span class="st">&quot;Crude Oil Prices-EIA.xls&quot;</span>), <span class="at">sheet =</span> <span class="st">&quot;Data 1&quot;</span>, <span class="at">skip =</span> <span class="dv">2</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">date =</span> <span class="dv">1</span>, <span class="at">crude =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ymd</span>(date))</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crude_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   date       crude
##   &lt;date&gt;     &lt;dbl&gt;
## 1 1986-01-03  25.8
## 2 1986-01-10  26.0
## 3 1986-01-17  24.6
## 4 1986-01-24  20.3
## 5 1986-01-31  19.7
## 6 1986-02-07  16.7</code></pre>
<p>The next step is to recognize that the dates for the soybean and biodiesel data do not perfectly match with the dates for the diesel and crude oil data (e.g., prices within the first set are measured on a Friday, and prices for the second set are measured on a Monday). It is useful to use the <em>yearweek()</em> function from the <em>tsibble</em> package to assign a common year-week ID for both sets of data. After creating the new <em>week</em> variable, the original <em>date</em> variable is deselected so that it is no longer part of the tibble.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>iowa_data <span class="ot">&lt;-</span> iowa_data <span class="sc">%&gt;%</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">yearweek</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">index=</span>week) <span class="sc">%&gt;%</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>diesel_data <span class="ot">&lt;-</span> diesel_data <span class="sc">%&gt;%</span> </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">yearweek</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">index=</span>week) <span class="sc">%&gt;%</span> </span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date)</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>crude_data <span class="ot">&lt;-</span> crude_data <span class="sc">%&gt;%</span> </span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">yearweek</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">index=</span>week) <span class="sc">%&gt;%</span> </span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date)</span></code></pre></div>
<p>With the dates aligned across the three data sets, it is possible to merge the two data sets. The joins are done in pairs and so in the first join the diesel and crude oil prices are merged, and in the second join the soybean oil and biodiesel prices are merged with the diesel and crude oil prices. Note that the <em>inner_join()</em> function from the <em>dplyr</em> package includes all rows which are present in both sets of data. After the join the <em>date</em> column is moved to the right of the last column. The merged data is then converted into a tibble and the <em>distinct()</em> function from the <em>dplyr</em> package is used to eliminate duplicate rows. After moving the <em>week</em> column to the left of the first column, the tibble is converted into a time series <em>tsibble</em>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>diesel_crude <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(diesel_data, crude_data,<span class="at">by=</span><span class="st">&quot;week&quot;</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(iowa_data,diesel_crude,<span class="at">by=</span><span class="st">&quot;week&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(week) <span class="sc">%&gt;%</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">index=</span>week) <span class="sc">%&gt;%</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> week)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 5 [1W]
##       week biodiesel soyoil diesel crude
##     &lt;week&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 2007 W15      3.1    29.9   2.84  62.6
## 2 2007 W16      3.1    29.3   2.88  63.1
## 3 2007 W17      3.08   30.2   2.85  65.3
## 4 2007 W18      3.14   31.1   2.81  63.8
## 5 2007 W19      3.14   31.1   2.79  61.9
## 6 2007 W20      3.18   32.9   2.77  63.6</code></pre>
<p>When working with weekly time series data it is common for the data for some weeks to be missing. With the data residing in tsibble object, the <em>check_gaps()</em> function can be used to identify the gaps. Note that when working with <em>tsibble</em> objects the <em>forecast</em> package must be loaded for the <em>check_gaps()</em> function to work:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>data_gaps <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count_gaps</span>(<span class="at">.full =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>data_gaps</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##      .from      .to    .n
##     &lt;week&gt;   &lt;week&gt; &lt;int&gt;
## 1 2013 W40 2013 W42     3
## 2 2016 W12 2016 W12     1
## 3 2017 W21 2017 W21     1</code></pre>
<p>We can see that data is missing for three consecutive weeks in 2013, one week in 2016 and one week in 2017. Data can be imputed for these missing weeks using the <em>fill_gaps()</em> function:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>biofuel <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill_gaps</span>(<span class="at">.full =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">biodiesel =</span> <span class="fu">na.interp</span>(biodiesel),</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">soyoil =</span> <span class="fu">na.interp</span>(soyoil), </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">diesel =</span> <span class="fu">na.interp</span>(diesel), </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">crude =</span> <span class="fu">na.interp</span>(crude))  </span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">head</span>(biofuel) </span></code></pre></div>
<pre><code>## # A tsibble: 6 x 5 [1W]
##       week biodiesel soyoil diesel crude
##     &lt;week&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 2007 W15      3.1    29.9   2.84  62.6
## 2 2007 W16      3.1    29.3   2.88  63.1
## 3 2007 W17      3.08   30.2   2.85  65.3
## 4 2007 W18      3.14   31.1   2.81  63.8
## 5 2007 W19      3.14   31.1   2.79  61.9
## 6 2007 W20      3.18   32.9   2.77  63.6</code></pre>
</div>
<div id="chapter-10-part-a-canada---u.s.-crude-oil" class="section level3 hasAnchor" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> Chapter 10 (Part A): Canada - U.S. Crude Oil<a href="#chapter-10-part-a-canada---u.s.-crude-oil" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This first data set for Chapter 10 consists of the monthly prices of West Texas Intermediate (wti) and Western Canada Select (wcs) crude oil plus the U.S. dollar index.</p>
<p>The pair of oil prices are read in from an Excel file. The usual preparation procedure is performed, which consists of converting the date to a month format and then using this converted date as the index for a <em>tsibble</em> time series object. The data is filtered to begin in January of 2005, which is the first month the wcs data is available.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>oil <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>, <span class="st">&quot;wti_wcs_price.xlsx&quot;</span>),</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">sheet =</span> <span class="st">&quot;amCharts&quot;</span>, <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;skip&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;numeric&quot;</span>,<span class="st">&quot;numeric&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month) <span class="sc">%&gt;%</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,wti,wcs) <span class="sc">%&gt;%</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">&quot;2005 Jan&quot;</span> <span class="sc">~</span>.)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(oil) </span></code></pre></div>
<pre><code>## # A tsibble: 6 x 3 [1M]
##      month   wti   wcs
##      &lt;mth&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 2005 Jan  46.8  29.4
## 2 2005 Feb  48.0  28.4
## 3 2005 Mar  54.6  36.5
## 4 2005 Apr  53.2  31.0
## 5 2005 May  49.9  27.5
## 6 2005 Jun  56.4  38.2</code></pre>
<p>To complete the first data set the U.S. dollar index is imported through use of a FRED api:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import crude oil prices from FRED</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>dollar <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;TWEXBGSMTH&quot;</span>,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2006-01-01&quot;</span>),</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-08-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dollar =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,dollar) </span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dollar)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##      month dollar
##      &lt;mth&gt;  &lt;dbl&gt;
## 1 2006 Jan  100  
## 2 2006 Feb  100. 
## 3 2006 Mar  100. 
## 4 2006 Apr   99.7
## 5 2006 May   97.5
## 6 2006 Jun   98.7</code></pre>
<p>The dollar index and the oil price data can now be merged.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>oil <span class="ot">&lt;-</span> oil <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(dollar,<span class="at">by=</span><span class="st">&quot;month&quot;</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(oil)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 4 [1M]
##      month   wti   wcs dollar
##      &lt;mth&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 2006 Jan  65.5  38.8  100  
## 2 2006 Feb  61.9  28.7  100. 
## 3 2006 Mar  63.0  36.8  100. 
## 4 2006 Apr  70.2  52.0   99.7
## 5 2006 May  71.0  57.3   97.5
## 6 2006 Jun  71.0  51.6   98.7</code></pre>
</div>
<div id="chapter-10-part-b-diesel-fuel-rainfall-and-vegetable-cpi" class="section level3 hasAnchor" number="1.4.4">
<h3><span class="header-section-number">1.4.4</span> Chapter 10 (Part B): Diesel Fuel, Rainfall and Vegetable CPI<a href="#chapter-10-part-b-diesel-fuel-rainfall-and-vegetable-cpi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The second data set is created by merging three individual monthly U.S. data sets: (1) fruit and vegetable CPI (F&amp;V CPI); (2) price of diesel fuel; (3) drought variables for six agricultural counties in California. The first two data sets come from FRED and the last one is imported from a series of worksheets in an Excel workbook. We begin by reading in the first two data sets and then aggregating from weekly to monthly data for the diesel data set.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>veggie_df <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;CUSR0000SAF113&quot;</span>,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1996-04-01&quot;</span>),</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-12-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">veggies =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month=</span><span class="fu">yearmonth</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(month,veggies)   </span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>diesel_wk <span class="ot">&lt;-</span> <span class="fu">fredr</span>(</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">series_id =</span> <span class="st">&quot;GASDESW&quot;</span>,</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;1996-04-01&quot;</span>),</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">observation_end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-12-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(date,value) <span class="sc">%&gt;%</span> </span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">diesel_wk =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>date)</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>diesel_df <span class="ot">&lt;-</span>diesel_wk <span class="sc">%&gt;%</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">index_by</span>(<span class="at">month =</span> <span class="sc">~</span> <span class="fu">yearmonth</span>(.)) <span class="sc">%&gt;%</span>  </span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">diesel =</span> <span class="fu">log</span>(<span class="fu">mean</span>(diesel_wk))) </span></code></pre></div>
<p>The drought data set consists of separate Excel worksheets for six of the leading agricultural counties in California: Fresno, Monterey, Kern, Ventura, San Diego and Imperial. Each worksheet contains several variables for measuring the percent of the land in the county which is experiencing drought for that particular week. Let’s import the five worksheets now.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>drought_fresno <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>,<span class="st">&quot;Data Tables  U.S. Drought Monitor.xlsx&quot;</span>),<span class="at">sheet=</span><span class="st">&quot;Fresno&quot;</span>,<span class="at">skip =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Week,<span class="st">&quot;D2-D4&quot;</span>,<span class="st">&quot;D3-D4&quot;</span>,<span class="st">&quot;D4&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">d2_4=</span><span class="dv">2</span>,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">d3_4=</span><span class="dv">3</span>,</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">d4=</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Week =</span> <span class="fu">as.Date</span>(Week)) <span class="sc">%&gt;%</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>Week)</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>drought_monterey <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>,<span class="st">&quot;Data Tables  U.S. Drought Monitor.xlsx&quot;</span>),<span class="at">sheet=</span><span class="st">&quot;Monterey&quot;</span>,<span class="at">skip =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Week,<span class="st">&quot;D2-D4&quot;</span>,<span class="st">&quot;D3-D4&quot;</span>,<span class="st">&quot;D4&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">d2_4=</span><span class="dv">2</span>,</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">d3_4=</span><span class="dv">3</span>,</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">d4=</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Week =</span> <span class="fu">as.Date</span>(Week)) <span class="sc">%&gt;%</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>Week)</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>drought_kern <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>,<span class="st">&quot;Data Tables  U.S. Drought Monitor.xlsx&quot;</span>),<span class="at">sheet=</span><span class="st">&quot;Kern&quot;</span>,<span class="at">skip =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Week,<span class="st">&quot;D2-D4&quot;</span>,<span class="st">&quot;D3-D4&quot;</span>,<span class="st">&quot;D4&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">d2_4=</span><span class="dv">2</span>,</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">d3_4=</span><span class="dv">3</span>,</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">d4=</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Week =</span> <span class="fu">as.Date</span>(Week)) <span class="sc">%&gt;%</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>Week)</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>drought_ventura <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>,<span class="st">&quot;Data Tables  U.S. Drought Monitor.xlsx&quot;</span>),<span class="at">sheet=</span><span class="st">&quot;Ventura&quot;</span>,<span class="at">skip =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Week,<span class="st">&quot;D2-D4&quot;</span>,<span class="st">&quot;D3-D4&quot;</span>,<span class="st">&quot;D4&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">d2_4=</span><span class="dv">2</span>,</span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">d3_4=</span><span class="dv">3</span>,</span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">d4=</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Week =</span> <span class="fu">as.Date</span>(Week)) <span class="sc">%&gt;%</span></span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>Week)</span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>drought_sandiego <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>,<span class="st">&quot;Data Tables  U.S. Drought Monitor.xlsx&quot;</span>),<span class="at">sheet=</span><span class="st">&quot;San Diego&quot;</span>,<span class="at">skip =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Week,<span class="st">&quot;D2-D4&quot;</span>,<span class="st">&quot;D3-D4&quot;</span>,<span class="st">&quot;D4&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">d2_4=</span><span class="dv">2</span>,</span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">d3_4=</span><span class="dv">3</span>,</span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">d4=</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Week =</span> <span class="fu">as.Date</span>(Week)) <span class="sc">%&gt;%</span></span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>Week)</span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a>drought_imperial <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>,<span class="st">&quot;Data Tables  U.S. Drought Monitor.xlsx&quot;</span>),<span class="at">sheet=</span><span class="st">&quot;Imperial&quot;</span>,<span class="at">skip =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Week,<span class="st">&quot;D2-D4&quot;</span>,<span class="st">&quot;D3-D4&quot;</span>,<span class="st">&quot;D4&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-43"><a href="#cb97-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">d2_4=</span><span class="dv">2</span>,</span>
<span id="cb97-44"><a href="#cb97-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">d3_4=</span><span class="dv">3</span>,</span>
<span id="cb97-45"><a href="#cb97-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">d4=</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-46"><a href="#cb97-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Week =</span> <span class="fu">as.Date</span>(Week)) <span class="sc">%&gt;%</span></span>
<span id="cb97-47"><a href="#cb97-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>Week)</span></code></pre></div>
<p>After creating six data frames from the imported worksheets a new data frame is created which is the average weekly value across the six counties for each drought variable. The weekly averages are then aggregated into a monthly average for each drought variable.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/31465415/combine-multiple-data-frames-and-calculate-average</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code></pre></div>
<pre><code>## Warning: package &#39;data.table&#39; was built under R version 4.2.1</code></pre>
<pre><code>## 
## Attaching package: &#39;data.table&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:reshape2&#39;:
## 
##     dcast, melt</code></pre>
<pre><code>## The following objects are masked from &#39;package:xts&#39;:
## 
##     first, last</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     transpose</code></pre>
<pre><code>## The following object is masked from &#39;package:tsibble&#39;:
## 
##     key</code></pre>
<pre><code>## The following objects are masked from &#39;package:lubridate&#39;:
## 
##     hour, isoweek, mday, minute, month, quarter, second, wday, week,
##     yday, year</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     between, first, last</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>drought_wk <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(drought_fresno,drought_monterey,drought_kern,drought_ventura,drought_sandiego,drought_imperial))[,<span class="fu">lapply</span>(.SD,mean), <span class="fu">list</span>(Week)] <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as_tsibble</span>(<span class="at">index=</span>Week)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>drought_df <span class="ot">&lt;-</span>drought_wk <span class="sc">%&gt;%</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">index_by</span>(<span class="at">month =</span> <span class="sc">~</span> <span class="fu">yearmonth</span>(.)) <span class="sc">%&gt;%</span>  </span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">d2_4 =</span> <span class="fu">mean</span>(d2_4),</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">d3_4 =</span> <span class="fu">mean</span>(d3_4),</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">d4 =</span> <span class="fu">mean</span>(d4)) </span></code></pre></div>
<p>The five data frames (F&amp;V cpi, meat cpi, diesel price, regular cpi and drought) can now be merged into a single data frame named <em>veggie</em>.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>list_df <span class="ot">=</span> <span class="fu">list</span>(veggie_df,diesel_df,drought_df)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>veggie <span class="ot">&lt;-</span> list_df <span class="sc">%&gt;%</span> <span class="fu">reduce</span>(inner_join, <span class="at">by=</span><span class="st">&#39;month&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mnth =</span> <span class="fu">month</span>(month)) <span class="sc">%&gt;%</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index=</span>month)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(veggie)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 7 [1M]
##      month veggies diesel  d2_4  d3_4    d4  mnth
##      &lt;mth&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1 2000 Jan    202.  0.305     0     0     0     1
## 2 2000 Feb    203.  0.379     0     0     0     2
## 3 2000 Mar    202.  0.391     0     0     0     3
## 4 2000 Apr    201.  0.352     0     0     0     4
## 5 2000 May    202.  0.350     0     0     0     5
## 6 2000 Jun    200.  0.352     0     0     0     6</code></pre>
</div>
<div id="chapter-11-data-to-be-determined" class="section level3 hasAnchor" number="1.4.5">
<h3><span class="header-section-number">1.4.5</span> Chapter 11: Data to be Determined<a href="#chapter-11-data-to-be-determined" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The data set for this chapter has not yet been finalized.</p>
</div>
</div>
<div id="sec:rds" class="section level2 hasAnchor" number="1.5">
<h2><span class="header-section-number">1.5</span> Saved RDS files<a href="#sec:rds" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section consists of the code for saving the data set for each chapter into a <em>.RDS</em> file. At the beginning of the empirical application in each chapter, the corresponding <em>.RDS</em> file is imported in order to make the prepared data available. THe lines of code are currently commented out. The code should be made live and the save initiated if a change is made to one or more of the data sets.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(wht_oil, here(&quot;data/ch3&quot;, &quot;wht_oil.RDS&quot;))</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(crude_daily, here(&quot;data/ch3&quot;, &quot;crude_daily.RDS&quot;)) </span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(cpi_mnth, here(&quot;data/ch3&quot;, &quot;cpi_mnth.RDS&quot;))</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(bananas, here(&quot;data/ch3&quot;, &quot;bananas.RDS&quot;))</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(ppi_potat, here(&quot;data/ch3&quot;, &quot;ppi_potat.RDS&quot;))</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(industrial, here(&quot;data/ch3&quot;, &quot;industrial.RDS&quot;))</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(eggs, here(&quot;data/ch3&quot;, &quot;eggs.RDS&quot;))</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(gas_city, here(&quot;data/ch3&quot;, &quot;gas_city.RDS&quot;))</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(break_simulate, here(&quot;data/ch3&quot;, &quot;break_simulate.RDS&quot;))</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(power, here(&quot;data/ch3&quot;, &quot;power.RDS&quot;))</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fruit, here(&quot;data/ch3&quot;, &quot;fruit.RDS&quot;))</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(gasoline, here(&quot;data/ch3&quot;, &quot;gasoline.RDS&quot;))</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(corn, here(&quot;data/ch3&quot;, &quot;corn.RDS&quot;))</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(cmo, here(&quot;data/ch3&quot;, &quot;vegoils.RDS&quot;)) </span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(energy_temp, here(&quot;data/ch3&quot;, &quot;energy_temp.RDS&quot;))</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(hogs, here(&quot;data/ch3&quot;, &quot;hogs.RDS&quot;))</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(data_sim, here(&quot;data/ch3&quot;, &quot;data_sim.RDS&quot;))</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(wood, here(&quot;data/ch3&quot;, &quot;wood.RDS&quot;))</span></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(biofuel, here(&quot;data/ch3&quot;, &quot;biofuel.RDS&quot;))</span></span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(oil, here(&quot;data/ch3&quot;, &quot;oil.RDS&quot;))</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(veggie, here(&quot;data/ch3&quot;, &quot;veggie.RDS&quot;))</span></span></code></pre></div>
<div id="extra-lumber-data" class="section level3 hasAnchor" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> Extra: Lumber Data<a href="#extra-lumber-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This last data set on lumber prices is currently not being used in any of the empirical analysis. It consists of the monthly prices of four types of U.S. lumber, one type of Swedish lumber and the U.S. - Sweden exchange rate. The data runs from January of 1997 to December of 2013. The U.S. prices are in a csv file, the Swedish price is in an Excel file and the exchange rate is in a csv file.</p>
<p>The dates in the U.S. data are into two separate columns (i.e., month with an abbreviated label in one column and year in a second column). The <em>match()</em> function matches the month abbreviation to a standard full month label. The <em>paste()</em> function is then used to paste the month and year labels together to create a new column which contains a month-year combo label. The <em>ym()</em> function can be applied to this new column to create the R date. The original month and year columns can then be deselected.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>lumbUSA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>, <span class="st">&quot;Lumber Assortment USA.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Rows: 204 Columns: 5
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): month
## dbl (4): year, df_2x4, west_ply, strd_brd
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a> lumbUSA <span class="ot">&lt;-</span> lumbUSA <span class="sc">%&gt;%</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ym</span>(<span class="fu">paste</span>(year, <span class="fu">match</span>(month,month.abb), <span class="at">sep=</span><span class="st">&quot;-&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(year,month))</span></code></pre></div>
<p>Preparing the Swedish lumber price data is relatively complex because the Excel file is organized to be used with an Excel search macro. It is best to assign no column names and to assume that all incoming data is in text format. If this latter option is not used then R will generate warnings due to a failure of the auto-detect function.</p>
<p>After the Swedish data is read in, the month and year columns, and the column which contains the price of the selected Swedish wood product are selected. As well, the data is sliced so that only those rows which correspond to the U.S. data are retained in the tibble. The preparing the Swedish table concludes by converting the prices from text to numeric and converting the month and year columns into a single R date. Also, the original month and year columns are deselected, similar to what was done for the U.S. lumber data.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>lumbSWD <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>,<span class="st">&quot;PriceOutputTable.xls&quot;</span>), <span class="at">sheet =</span> <span class="st">&quot;Data&quot;</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>, <span class="at">col_types =</span> <span class="st">&quot;text&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> <span class="dv">1</span>, <span class="at">month =</span> <span class="dv">2</span>, <span class="at">sweden =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">462</span><span class="sc">:</span><span class="dv">749</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sweden=</span><span class="fu">as.numeric</span>(sweden)) <span class="sc">%&gt;%</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ym</span>(<span class="fu">paste</span>(year, <span class="fu">match</span>(month,month.abb), <span class="at">sep=</span><span class="st">&quot;-&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(year,month))</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lumbSWD)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   sweden date      
##    &lt;dbl&gt; &lt;date&gt;    
## 1   1494 1997-01-01
## 2   1580 1997-02-01
## 3   1650 1997-03-01
## 4   1628 1997-04-01
## 5   1646 1997-05-01
## 6   1671 1997-06-01</code></pre>
<p>Reading in the exchange rate data is straight forward because there are only two columns and the date column has a standard format:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>exchange <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/ch3&quot;</span>, <span class="st">&quot;EXSDUS.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">mdy</span>(DATE)) <span class="sc">%&gt;%</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>DATE) </span></code></pre></div>
<pre><code>## Rows: 614 Columns: 2
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): DATE
## dbl (1): EXSDUS
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>We can now merge the prepared U.S. and Swedish data, and then merge the resulting tibble with the exchange rate data. The last step is to convert the resulting tibble to a time series tsibble object.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>lumber_both <span class="ot">&lt;-</span> <span class="fu">merge</span>(lumbUSA,lumbSWD,<span class="at">by=</span><span class="st">&quot;date&quot;</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>lumber <span class="ot">&lt;-</span> <span class="fu">merge</span>(lumber_both,exchange,<span class="at">by=</span><span class="st">&quot;date&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tsibble</span>(<span class="at">index =</span> date)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lumber)</span></code></pre></div>
<pre><code>## # A tsibble: 6 x 6 [1D]
##   date       df_2x4 west_ply strd_brd sweden EXSDUS
##   &lt;date&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 1997-01-01    356      294      242   1494   7.07
## 2 1997-02-01    371      315      249   1580   7.41
## 3 1997-03-01    364      319      239   1650   7.65
## 4 1997-04-01    384      303      231   1628   7.69
## 5 1997-05-01    383      314      230   1646   7.69
## 6 1997-06-01    378      343      235   1671   7.75</code></pre>
</div>
</div>
<div id="conclusions" class="section level2 hasAnchor" number="1.6">
<h2><span class="header-section-number">1.6</span> Conclusions<a href="#conclusions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this chapter a variety of methods were used to import and prepare data. The easiest preparation is for the data imported by API from the FRED website. This is because the data is standardized and so the same preparation steps can be used for each data set. Importing data from Excel files and csv files are similar regarding preparation steps. Excel has the advantage that a “source” worksheet can be used to describe where and when the data was accessed. It is important to identify when the data was accessed from a website so that different versions of the data can be effectively managed.</p>
<p>When accessing data from a website it is tempting to do some of the initial preparation steps in Excel. For example, it may be tempting to delete a blank row between the header and the first row of data, or perhaps merge two data sets before reading the data into R. Resist this temptation because it moves the analysis further from reproducibility. The goal is to make it as easy as possible for another researcher to be able to reproduce your results. It is for this reason why it is preferable to import data using API rather than downloading the data to a csv or Excel file and then reading the data into R.</p>
<p>{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
.packages(), ‘bookdown’, ‘knitr’, ‘rmarkdown’
), ‘packages.bib’)
```</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/%s",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
